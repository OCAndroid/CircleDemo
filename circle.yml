dependencies:
  pre:
    - source scripts/environmentSetup.sh && getAndroidSDK
  cache_directories:
    - /usr/local/android-sdk-linux/build-tools/26.0.2
    - /usr/local/android-sdk-linux/platforms/android-26
    - /usr/local/android-sdk-linux/extras/android/m2repository

test:
  override:
    - ./gradlew test
    # copy the build outputs to artifacts
    - cp -r app/build/outputs $CIRCLE_ARTIFACTS
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
  hockey:
    branch:
      - master
      - /circle-1.0-.*/
    commands:
      - echo "Bundling Release"
      - ./gradlew assembleRelease -PdisablePreDex -PCI=$CI -PstorePassword=$STORE_PASSWORD -PkeyAlias=$KEY_ALIAS -PkeyPassword=$KEY_PASSWORD:
          timeout: 600
      - source scripts/deployHockeyApp.sh && uploadToHockeyApp